# .pre-commit-config.yaml
# ==============================
# 说明：
# - 本地提交（git commit）前自动运行守护脚本（Patch Fence + Invariants）。
# - 守护入口：scripts/guards/run_guards.py
#   * 自动从 git "已暂存的改动" 中推导变更文件列表，传给 Patch Fence，开发期/严格期都可用。
#   * 支持宽松模式（--lenient 或 GUARDS_MODE=dev）：越界仅警告不拦截；严格期不加该参数即可严格拦截。
# - 使用：
#   1) pip install pre-commit
#   2) pre-commit install
#   之后每次 commit 会自动运行本钩子；也可随时手动运行：
#      python scripts/guards/run_guards.py（默认严格）或
#      python scripts/guards/run_guards.py --lenient（开发宽松）
# ==============================

repos:
  - repo: local                         # 本地自定义 hook
    hooks:
      - id: chan-guards                 # 钩子 ID（任意命名）
        name: ChanTheory Guards         # 显示名称
        entry: python scripts/guards/run_guards.py   # 执行入口（统一跑 Fence + Invariants）
        language: system                # 直接用系统 Python 运行
        pass_filenames: false           # 不传文件名，入口脚本会自行解析 git 暂存内容
        stages: [pre-commit]                # 在 commit 阶段触发
        # 注意：如果希望提交时使用“开发宽松���式”，可以改为：
        # entry: bash -lc "export GUARDS_MODE=dev; python scripts/guards/run_guards.py"
        # 保持当前严格默认，日常建议手动在命令行跑 --lenient 或设置环境变量 GUARDS_MODE=dev
